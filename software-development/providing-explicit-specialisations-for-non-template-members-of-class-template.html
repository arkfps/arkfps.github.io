<!DOCTYPE html> <html lang=en-GB itemscope itemtype=https://schema.org/BlogPosting prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"> <head> <meta charset=utf-8>  <meta http-equiv=Content-Security-Policy content="default-src https: data: 'unsafe-inline' wss:; form-action https:; block-all-mixed-content; base-uri 'self'; referrer origin-when-cross-origin">  <meta name=viewport content="width=device-width,initial-scale=1">  <title>Providing Explicit Specialisations for Non‐Template Members of Class Template</title> <meta itemprop=name content="Providing Explicit Specialisations for Non‐Template Members of Class Template"> <meta property=og:title content="Providing Explicit Specialisations for Non‐Template Members of Class Template">  <meta name=description content="It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!"> <meta itemprop=description content="It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!"> <meta property=og:description content="It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!">   <meta name=keywords content="C++,Generic Programming"> <meta itemprop=keywords content="C++,Generic Programming">  <meta name=author content="Pavel Frolov"> <link rel=author type=text/plain href=/humans.txt>   <meta property=og:image content=https://thehermeticvault.com/img/pages/goethe-schiller-monument.jpg> <meta property=og:image:type content="image/jpeg"> <meta property=og:image:width content="1440"> <meta property=og:image:height content="1080">  <meta property=og:site_name content="The Hermetic Vault"> <meta property=og:type content=article> <meta property=og:locale content=en_GB>  <meta property=article:published_time content=2015-01-17T00:00:00+03:00> <meta property=article:modified_time content=2016-02-02T08:49:18+03:00> <meta property=article:author content=https://www.facebook.com/psfrolov> <meta property=article:section content="Software Development"> <meta property=article:tag content=C++> <meta property=article:tag content="Generic Programming">   <meta name=twitter:card content=summary_large_image> <meta name=twitter:site:id content=4133911523> <meta name=twitter:creator:id content=4133911523>  <link rel=apple-touch-icon sizes=57x57 href=/apple-touch-icon-57x57.aaf54ad4.png> <link rel=apple-touch-icon sizes=60x60 href=/apple-touch-icon-60x60.92f40ccf.png> <link rel=apple-touch-icon sizes=72x72 href=/apple-touch-icon-72x72.f13eb2d8.png> <link rel=apple-touch-icon sizes=76x76 href=/apple-touch-icon-76x76.d9913b14.png> <link rel=apple-touch-icon sizes=114x114 href=/apple-touch-icon-114x114.fb7fa749.png> <link rel=apple-touch-icon sizes=120x120 href=/apple-touch-icon-120x120.dc690543.png> <link rel=apple-touch-icon sizes=144x144 href=/apple-touch-icon-144x144.cb6c1692.png> <link rel=apple-touch-icon sizes=152x152 href=/apple-touch-icon-152x152.2752eea1.png> <link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon-180x180.039d6cab.png> <link rel=icon type=image/png href=/favicon-32x32.30180f81.png sizes=32x32> <link rel=icon type=image/png href=/favicon-194x194.1000be56.png sizes=194x194> <link rel=icon type=image/png href=/favicon-96x96.f2faacce.png sizes=96x96> <link rel=icon type=image/png href=/android-chrome-192x192.4cbd868f.png sizes=192x192> <link rel=icon type=image/png href=/favicon-16x16.a89c5d9c.png sizes=16x16> <link rel=manifest href=/manifest.1511a6ac.json> <link rel=mask-icon href=/safari-pinned-tab.e5d3bbf2.svg color=#ac4142> <meta name=msapplication-TileColor content=#ac4142> <meta name=msapplication-TileImage content=/mstile-144x144.0b30aa6d.png> <meta name=theme-color content=#ac4142>  <link rel=canonical href=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template> <link itemprop="url mainEntityOfPage" href=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template> <meta property=og:url content=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template>      <link rel=stylesheet href=/css/app.ad2ca5d4.css> </head> <body> <aside class="sidebar container"> <header> <h1> <a rel=home href="/"> <svg class="icon icon-balance-scale" role=img> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-balance-scale"/> </svg><br> The Hermetic Vault </a> </h1> <p> typedef typename template </p> </header> <section> <h2> <svg class="icon icon-tags" role=img> <title>Site Tags</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-tags"/> </svg> </h2> <ul class=inline> <li> <a href=/tag/.net>.NET</a>&nbsp;‡ </li> <li> <a href=/tag/appveyor>AppVeyor</a>&nbsp;‡ </li> <li> <a href=/tag/boost>Boost</a>&nbsp;‡ </li> <li> <a href=/tag/c%2B%2B>C++</a>&nbsp;‡ </li> <li> <a href=/tag/ci>CI</a>&nbsp;‡ </li> <li> <a href=/tag/coverity>Coverity</a>&nbsp;‡ </li> <li> <a href=/tag/design-patterns>Design Patterns</a>&nbsp;‡ </li> <li> <a href=/tag/generic-programming>Generic Programming</a>&nbsp;‡ </li> <li> <a href=/tag/oop>OOP</a>&nbsp;‡ </li> <li> <a href=/tag/powershell>PowerShell</a>&nbsp;‡ </li> <li> <a href=/tag/static-analysis>Static Analysis</a>&nbsp;‡ </li> <li> <a href=/tag/windows-api>Windows API</a> </li> </ul> </section> <nav> <h2 class=visuallyhidden>Site Navigation</h2> <ul class=inline> <li> <a rel=home class="link-icon nav-icon" href=/ title=Home> <svg class="icon icon-home" role=img> <title>Home</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-home"/> </svg> </a> </li> <li> <a class="link-icon nav-icon" href=/archive title=Archive> <svg class="icon icon-list" role=img> <title>Archive</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-list"/> </svg> </a> </li> <li> <a rel="home alternate" class="link-icon nav-icon" href=/atom.xml title="News Feed"> <svg class="icon icon-feed" role=img> <title>News Feed</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-feed"/> </svg> </a> </li> <li> <a class="link-icon nav-icon" href=/contact title=Contact> <svg class="icon icon-question" role=img> <title>Contact</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-question"/> </svg> </a> </li> <li> <a rel=author class="link-icon nav-icon" href=/about title=About> <svg class="icon icon-info" role=img> <title>About</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-info"/> </svg> </a> </li> </ul> </nav> <hr> <footer> <ul class=inline> <li> <a href=/legal/disclaimer><small>Disclaimer</small></a> <small>‡</small> </li> <li> <a href=/legal/privacy-policy title="Privacy Policy"><small>Privacy</small></a> </li> </ul> <p> <small>© 2016 TheHermeticVault.com</small> </p> </footer> </aside> <main class="content container">  <div class=page-image itemprop=image itemscope itemtype=https://schema.org/ImageObject> <img src=/img/pages/goethe-schiller-monument.jpg alt="Goethe–Schiller Monument, Syracuse, New York State" itemprop="url contentUrl" width=1440 height=1080> <meta itemprop=width content=1440> <meta itemprop=height content=1080> <small> Goethe–Schiller Monument, Syracuse, New York State (Image by <a href=https://en.wikipedia.org/wiki/File:Goethe-Schiller_Monument_-_Syracuse.jpg rel=external itemprop=author>Easchiff</a>) </small> </div>  <article> <h1 itemprop=headline>Providing Explicit Specialisations for Non‐Template Members of Class Template</h1> <footer> <h2 class=visuallyhidden>Metadata</h2>  <dl class="inline grey"> <dt> <svg class="icon icon-clock-o" role=img> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-clock-o"/> </svg> Published: </dt> <dd> <time datetime=2015-01-17T00:00:00+03:00 itemprop=datePublished>17 Jan 2015</time>. </dd> <dt> <svg class="icon icon-newspaper-o" role=img> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-newspaper-o"/> </svg> Reading time: </dt> <dd> <time datetime=PT4M itemprop=timeRequired>4 minutes</time>. </dd> <dt class=new-line> <svg class="icon icon-tags" role=img> <title>Tags</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-tags"/> </svg> </dt> <dd> <ul class=inline> <li> <a rel=tag class=main-muted href=/tag/c%2B%2B>C++</a>, </li> <li> <a rel=tag class=main-muted href=/tag/generic-programming>Generic Programming</a>. </li> </ul> </dd> </dl> <meta itemprop=wordCount content=1451> <meta itemprop="articleSection about" content="Software Development"> <meta itemprop=author content="Pavel Frolov"> <span itemprop=publisher itemscope itemtype=https://schema.org/Organization> <meta itemprop=name content="The Hermetic Vault"> <span itemprop=logo itemscope itemtype=https://schema.org/ImageObject> <link itemprop="url contentUrl" href=/img/pages/logo.png> <meta itemprop=width content=600> <meta itemprop=height content=60> </span> </span> <meta itemprop=dateModified content=2016-02-02T08:49:18+03:00> </footer> <div class=drop-letter itemprop=articleBody> <p>C++ is full of surprises (albeit not always good ones <svg class="icon icon-smile-o" role=img><title>Smiley Face</title><use xlink:href=/svg/symbol-defs.f828a296.svg#icon-smile-o></use></svg>). It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!</p> <h2 id=technical-details>Technical Details</h2> <p>The following non‐template members of class template can be explicitly specialised:</p> <ul> <li>member function (either static or not);</li> <li>static data member;</li> <li>member enumeration (since C++11);</li> <li>member class.</li> </ul> <p>Let’s see some examples:</p> <noscript><pre>// Tested with Clang 3.4, GCC 4.8.2.

#include &lt;iostream&gt;
#include &lt;string&gt;


template&lt;typename T&gt; class Foo {
public:
  std::string Method();
  static std::string StaticMethod();
  static const std::string StaticData;
  enum class Enum;
  struct InnerStruct{ static const std::string StaticData; };  
};

template&lt;typename T&gt; std::string Foo&lt;T&gt;::Method() {
  return &quot;std::string Foo&lt;T&gt;::Method() - primary template.&quot;;
}

template&lt;&gt; std::string Foo&lt;char&gt;::Method() {
  return &quot;std::string Foo&lt;T&gt;::Method() - &quot;
         &quot;explicit specialisation for &lt;char&gt;.&quot;;
}

template&lt;typename T&gt; std::string Foo&lt;T&gt;::StaticMethod() {
  return &quot;std::string Foo&lt;T&gt;::StaticMethod() - primary template.&quot;;
}

template&lt;&gt; std::string Foo&lt;char&gt;::StaticMethod() {
  return &quot;std::string Foo&lt;char&gt;::StaticMethod() - &quot;
         &quot;explicit specialisation for &lt;char&gt;.&quot;;
}   

template&lt;typename T&gt; const std::string Foo&lt;T&gt;::StaticData{
  &quot;std::string Foo&lt;T&gt;::StaticData - primary template.&quot; };

template&lt;&gt; const std::string Foo&lt;char&gt;::StaticData{
  &quot;std::string Foo&lt;char&gt;::StaticData - &quot;
  &quot;explicit specialisation for &lt;char&gt;.&quot; };

template&lt;typename T&gt; enum class Foo&lt;T&gt;::Enum { Primary = 0 };

template&lt;&gt; enum class Foo&lt;char&gt;::Enum { Specialised = 1 };

template&lt;typename T&gt; const std::string Foo&lt;T&gt;::InnerStruct::StaticData{
  &quot;std::string Foo&lt;T&gt;::InnerStruct::StaticData - primary template.&quot; };

template&lt;&gt; struct Foo&lt;char&gt;::InnerStruct{ static const std::string StaticData; };
const std::string Foo&lt;char&gt;::InnerStruct::StaticData{
  &quot;std::string Foo&lt;char&gt;::InnerStruct::StaticData - &quot;
  &quot;explicit specialisation for &lt;char&gt;.&quot; };


int main() {
  // Member function.
  std::cout &lt;&lt; Foo&lt;int&gt;().Method() &lt;&lt; std::endl;
  std::cout &lt;&lt; Foo&lt;char&gt;().Method() &lt;&lt; std::endl;
  
  // Static member function.  
  std::cout &lt;&lt; Foo&lt;int&gt;::StaticMethod() &lt;&lt; std::endl;
  std::cout &lt;&lt; Foo&lt;char&gt;::StaticMethod() &lt;&lt; std::endl;
  
  // Static data member.  
  std::cout &lt;&lt; Foo&lt;int&gt;::StaticData &lt;&lt; std::endl;
  std::cout &lt;&lt; Foo&lt;char&gt;::StaticData &lt;&lt; std::endl;
    
  // Member enumeration.  
  std::cout &lt;&lt; static_cast&lt;int&gt;(Foo&lt;int&gt;::Enum::Primary) &lt;&lt; std::endl;
  std::cout &lt;&lt; static_cast&lt;int&gt;(Foo&lt;char&gt;::Enum::Specialised) &lt;&lt; std::endl;
  
  // Member class.  
  std::cout &lt;&lt; Foo&lt;int&gt;::InnerStruct::StaticData &lt;&lt; std::endl;
  std::cout &lt;&lt; Foo&lt;char&gt;::InnerStruct::StaticData &lt;&lt; std::endl;
}
</pre></noscript> <script src=https://gist.github.com/arkfps/c15788b10323bd4d5c54.js></script><p>When this can be useful? Whenever you need some conditional logic for you class template based on template parameters, but that logic takes only a small fraction of class code. For example, you may have a class containing a dozen of methods, but only a couple of them require behaviour specific to template arguments. In that case, it is not practical to define explicit specialisation for the whole class due to large amount of code duplication. The better solution is to define specialisations only for those specific methods.</p> <p>Perhaps the most useful part of this feature is the ability to specialise member functions. Let’s take a look at a concrete example.</p> <h2 id=implementing-generic-raii-wrapper-for-resource-handles>Implementing Generic <abbr title="Resource Acquisition Is Initialization">RAII</abbr> Wrapper for Resource Handles</h2> <p>Opaque resource handles are used in many OS‐level, networking, and database APIs. Usually such handles must be closed with some kind of <strong>close_handle</strong> function. When dealing with handles in C++ you almost always want to use <em><abbr title="Resource Acquisition Is Initialization">RAII</abbr></em><sup id=fnref:fn-raii><a href=#fn:fn-raii class=footnote>1</a></sup> wrapper to avoid handle leaks. We can define such a wrapper as follows:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=cp>#include &lt;cassert&gt;
#include &lt;memory&gt;  // std::addressof
</span>
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>HandleType</span> <span class=o>=</span> <span class=n>OsHandle</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Handle</span> <span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
  <span class=n>Handle</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
  <span class=k>explicit</span> <span class=nf>Handle</span><span class=p>(</span><span class=n>HandleType</span> <span class=n>handle</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>handle</span> <span class=p>}</span> <span class=p>{}</span>

  <span class=o>~</span><span class=n>Handle</span><span class=p>()</span> <span class=p>{</span> <span class=n>Cleanup</span><span class=p>();</span> <span class=p>}</span>

  <span class=c1>// Noncopyable.
</span>  <span class=n>Handle</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
  <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>

  <span class=c1>// Movable.
</span>  <span class=n>Handle</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=p>}</span> <span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span> <span class=p>}</span>
  <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>assert</span><span class=p>(</span><span class=k>this</span> <span class=o>!=</span> <span class=n>std</span><span class=o>::</span><span class=n>addressof</span><span class=p>(</span><span class=n>other</span><span class=p>));</span>
    <span class=n>Cleanup</span><span class=p>();</span>
    <span class=n>handle_</span> <span class=o>=</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span><span class=p>;</span>
    <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span>
    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=n>HandleType</span><span class=o>*</span> <span class=k>operator</span><span class=o>&amp;</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>Cleanup</span><span class=p>();</span>
    <span class=k>return</span> <span class=o>&amp;</span><span class=n>handle_</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=k>explicit</span> <span class=k>operator</span> <span class=n>HandleType</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>handle_</span><span class=p>;</span> <span class=p>}</span>

<span class=k>private</span><span class=o>:</span>
  <span class=kt>void</span> <span class=n>Cleanup</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handle_</span><span class=p>)</span>
      <span class=n>CloseOsHandle</span><span class=p>(</span><span class=n>handle_</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=n>HandleType</span> <span class=n>handle_</span><span class=p>{};</span>
<span class=p>};</span></code></pre></figure> <p>Here <code class=highlighter-rouge>OsHandle</code> is some common handle type in our hypothetical operating system which needs to be closed by <code class=highlighter-rouge>CloseOsHandle</code> function (the real world example is Windows API <code class=highlighter-rouge>HANDLE</code> type with corresponding <code class=highlighter-rouge>CloseHandle</code> function). Example usage:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=n>Handle</span><span class=o>&lt;&gt;</span> <span class=n>handle1</span><span class=p>;</span>  <span class=c1>// using default handle type
</span><span class=n>Handle</span><span class=o>&lt;</span><span class=n>OsHandle</span><span class=o>&gt;</span> <span class=n>handle2</span><span class=p>;</span>  <span class=c1>// same as above, explicit
</span><span class=n>Handle</span><span class=o>&lt;</span><span class=n>OsFileHandle</span><span class=o>&gt;</span> <span class=n>handle3</span><span class=p>;</span>  <span class=o>//</span> <span class=n>OS</span><span class=o>-</span><span class=n>specific</span> <span class=n>file</span> <span class=n>handle</span></code></pre></figure> <p>Now suppose we want to use <code class=highlighter-rouge>OsInternetHandle</code> which requires specific <code class=highlighter-rouge>CloseOsInternetHandle</code> function to be closed (this is also common in Windows API: for example, WinHttp <code class=highlighter-rouge>HINTERNET</code> handle requires <code class=highlighter-rouge>WinHttpCloseHandle</code>). We can specialise our <code class=highlighter-rouge>Handle</code> class for <code class=highlighter-rouge>OsInternetHandle</code>:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=k>template</span><span class=o>&lt;&gt;</span> <span class=k>class</span> <span class=nc>Handle</span><span class=o>&lt;</span><span class=n>OsInternetHandle</span><span class=o>&gt;</span> <span class=p>{</span>
<span class=k>public</span><span class=o>:</span>
  <span class=n>Handle</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
  <span class=k>explicit</span> <span class=nf>Handle</span><span class=p>(</span><span class=n>OsInternetHandle</span> <span class=n>handle</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>handle</span> <span class=p>}</span> <span class=p>{}</span>

  <span class=o>~</span><span class=n>Handle</span><span class=p>()</span> <span class=p>{</span> <span class=n>Cleanup</span><span class=p>();</span> <span class=p>}</span>

  <span class=c1>// Noncopyable.
</span>  <span class=n>Handle</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
  <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>

  <span class=c1>// Movable.
</span>  <span class=n>Handle</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=p>}</span> <span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span> <span class=p>}</span>
  <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>assert</span><span class=p>(</span><span class=k>this</span> <span class=o>!=</span> <span class=n>std</span><span class=o>::</span><span class=n>addressof</span><span class=p>(</span><span class=n>other</span><span class=p>));</span>
    <span class=n>Cleanup</span><span class=p>();</span>
    <span class=n>handle_</span> <span class=o>=</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span><span class=p>;</span>
    <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span>
    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=n>OsInternetHandle</span><span class=o>*</span> <span class=k>operator</span><span class=o>&amp;</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>Cleanup</span><span class=p>();</span>
    <span class=k>return</span> <span class=o>&amp;</span><span class=n>handle_</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=k>explicit</span> <span class=k>operator</span> <span class=n>OsInternetHandle</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>handle_</span><span class=p>;</span> <span class=p>}</span>

<span class=k>private</span><span class=o>:</span>
  <span class=kt>void</span> <span class=n>Cleanup</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handle_</span><span class=p>)</span>
      <span class=n>CloseOsInternetHandle</span><span class=p>(</span><span class=n>handle_</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=n>OsInternetHandle</span> <span class=n>handle_</span><span class=p>{};</span>
<span class=p>};</span></code></pre></figure> <p>The problem is solved, but the cost is a lot of code duplication. As you can see, the only real difference between specialised and primary template is <code class=highlighter-rouge>Cleanup</code> method. Let’s leave our <code class=highlighter-rouge>Handle</code> class definition as is and define specialisation for <code class=highlighter-rouge>Cleanup</code> member function instead:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=k>template</span><span class=o>&lt;&gt;</span> <span class=kt>void</span> <span class=n>Handle</span><span class=o>&lt;</span><span class=n>OsInternetHandle</span><span class=o>&gt;::</span><span class=n>Cleanup</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>if</span> <span class=p>(</span><span class=n>handle_</span><span class=p>)</span>
    <span class=n>CloseOsInternetHandle</span><span class=p>(</span><span class=n>handle_</span><span class=p>);</span>
<span class=p>}</span></code></pre></figure> <p>This is much better for maintainability and works exactly like the class specialisation above.</p> <p>Note that our handle wrapper is somewhat simplified for the purpose of the article. It is assumed that various <code class=highlighter-rouge>HandleType</code> arguments are in fact different types, not an aliases for some built‐in type like <code class=highlighter-rouge>int</code> or <code class=highlighter-rouge>void*</code>. For example, if our <code class=highlighter-rouge>OsHandle</code> and <code class=highlighter-rouge>OsInternetHandle</code> are both defined as synonyms for <code class=highlighter-rouge>int</code>, the above specialisation will not work. For that reason, in real life you almost certainly should apply <a rel=external href=https://isocpp.org/blog/2015/01/type-safe-handles-in-c-emil-ernerfeldt>type‐safe handle idiom</a> to your wrapper class described in the recent <a rel=external href=https://isocpp.org>isocpp.org</a> post by Emil Ernerfeldt. Then you can specialise <code class=highlighter-rouge>Cleanup</code> method on handle tag (which is effectively a form of <em>tag dispatching</em><sup id=fnref:fn-tag-dispatching><a href=#fn:fn-tag-dispatching class=footnote>2</a></sup>).</p> <h2 id=conclusion>Conclusion</h2> <p>Although described in <cite>Section 14.7 [temp.spec] of the C++ ISO/IEC standard</cite>, this unobvious feature is poorly documented elsewhere. In fact, I’ve found only a couple of reference manuals mentioning it:</p> <ul> <li><a rel=external href=http://en.cppreference.com/w/cpp/language/template_specialization>cppreference.com</a>;</li> <li><a rel=external href=https://www-01.ibm.com/support/knowledgecenter/SSLTBW_2.1.0/com.ibm.zos.v2r1.cbclx01/explicit_specialization.htm>z/OS XL C/C++ Language Reference</a>.</li> </ul> <hr> <div class=footnotes> <ol> <li id=fn:fn-raii> <p><a href=https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization>Resource Acquisition Is Initialization</a>. <a href=#fnref:fn-raii class=reversefootnote>&#8617;</a></p> </li> <li id=fn:fn-tag-dispatching> <p>Tag dispatching is a way of using function overloading to dispatch based on properties of a type. See <a rel=external href=https://isocpp.org/blog/2014/12/tag-dispatching>tutorial on tag dispatching</a>. <a href=#fnref:fn-tag-dispatching class=reversefootnote>&#8617;</a></p> </li> </ol> </div> </div>  <aside> <h2 class=visuallyhidden>Share</h2> <ul class=inline> <li> <a rel=external class="link-icon content-icon" href="https://www.facebook.com/sharer/sharer.php?u=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template" target=_blank title="Share on Facebook (opens new window)"> <svg class="icon icon-facebook-square" role=img> <title>Share on Facebook (opens new window)</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-facebook-square"/> </svg> </a> </li> <li> <a rel=external class="link-icon content-icon" href="https://twitter.com/share?url=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template&amp;hashtags=Cpp,GenericProgramming" target=_blank title="Share on Twitter (opens new window)"> <svg class="icon icon-twitter-square" role=img> <title>Share on Twitter (opens new window)</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-twitter-square"/> </svg> </a> </li> <li> <a rel=external class="link-icon content-icon" href="https://www.reddit.com/submit?url=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template&amp;title=Providing%20Explicit%20Specialisations%20for%20Non%E2%80%90Template%20Members%20of%20Class%20Template" target=_blank title="Share on Reddit (opens new window)"> <svg class="icon icon-reddit-square" role=img> <title>Share on Reddit (opens new window)</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-reddit-square"/> </svg> </a> </li> <li> <a rel=external class="link-icon content-icon" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template" target=_blank title="Share on LinkedIn (opens new window)"> <svg class="icon icon-linkedin-square" role=img> <title>Share on LinkedIn (opens new window)</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-linkedin-square"/> </svg> </a> </li> <li> <a rel=external class="link-icon content-icon" href="https://plus.google.com/share?url=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template" target=_blank title="Share on Google+ (opens new window)"> <svg class="icon icon-google-plus-square" role=img> <title>Share on Google+ (opens new window)</title> <use xlink:href="/svg/symbol-defs.f828a296.svg#icon-google-plus-square"/> </svg> </a> </li> </ul> </aside>  <aside> <h2 class=visuallyhidden>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template",this.page.identifier="providing-explicit-specialisations-for-non-template-members-of-class-template",this.page.title="Providing Explicit Specialisations for Non‐Template Members of Class Template"};!function(){var e=document,t=e.createElement("script");t.src="//arkfps.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel="nofollow external">comments powered by Disqus.</a></noscript> </aside> </article>  <script type=application/ld+json>{ "@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [ { "@type": "ListItem", "position": 1, "item": { "@id": "https://thehermeticvault.com", "name": "Home" } }, { "@type": "ListItem", "position": 2, "item": { "@id": "https://thehermeticvault.com/tag/c%2B%2B", "name": "C++" } }, { "@type": "ListItem", "position": 3, "item": { "@id": "https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template", "name": "Providing Explicit Specialisations for Non‐Template Members of Class Template" } } ] }</script><script type=application/ld+json>{ "@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [ { "@type": "ListItem", "position": 1, "item": { "@id": "https://thehermeticvault.com", "name": "Home" } }, { "@type": "ListItem", "position": 2, "item": { "@id": "https://thehermeticvault.com/tag/generic-programming", "name": "Generic Programming" } }, { "@type": "ListItem", "position": 3, "item": { "@id": "https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template", "name": "Providing Explicit Specialisations for Non‐Template Members of Class Template" } } ] }</script></main><script src=/js/svgxuse.11656d77.js></script></body></html>