<!DOCTYPE html> <html itemscope itemtype=https://schema.org/BlogPosting lang=en-GB prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport> <title>Providing Explicit Specialisations for Non‐Template Members of Class Template</title> <meta content="Providing Explicit Specialisations for Non‐Template Members of Class Template" itemprop=name> <meta content="Providing Explicit Specialisations for Non‐Template Members of Class Template" property=og:title> <meta content="It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!" name=description> <meta content="It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!" itemprop=description> <meta content="It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!" property=og:description> <meta content="C++,Generic Programming" name=keywords> <meta content="C++,Generic Programming" itemprop=keywords> <meta content="Pavel Frolov" name=author> <meta content=https://thehermeticvault.com/img/pages/goethe-schiller-monument.jpg property=og:image> <meta content="Goethe–Schiller Monument, Syracuse, New York State" property=og:image:alt> <meta content=image/jpeg property=og:image:type> <meta content=1440 property=og:image:width> <meta content=1080 property=og:image:height> <meta content="Goethe–Schiller Monument, Syracuse, New York State" name=twitter:image:alt> <meta content="The Hermetic Vault" property=og:site_name> <meta content=article property=og:type> <meta content=en_GB property=og:locale> <meta content=2019-09-28T21:51:17+03:00 property=og:updated_time> <meta content=true property=og:rich_attachment> <meta content=416481208892021 property=fb:app_id> <meta content=100005735232020 property=fb:profile_id> <meta content=2015-01-17T00:00:00+03:00 property=article:published_time> <meta content=2019-09-28T21:51:17+03:00 property=article:modified_time> <meta content=https://www.facebook.com/100005735232020 property=article:author> <meta content="Software Development" property=article:section> <meta content=C++ property=article:tag> <meta content="Generic Programming" property=article:tag> <meta content=summary_large_image name=twitter:card> <meta content=4133911523 name=twitter:site:id> <meta content=4133911523 name=twitter:creator:id> <link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180> <link href=/favicon-32x32.png rel=icon sizes=32x32 type=image/png> <link href=/favicon-16x16.png rel=icon sizes=16x16 type=image/png> <link href=/manifest.9a62a12f.json rel=manifest> <link href=/safari-pinned-tab.0312f9c8.svg rel=mask-icon color=#404040> <meta content=#404040 name=theme-color> <link href=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template rel=canonical> <link href=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template itemprop="url mainEntityOfPage"> <meta content=https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template property=og:url> <link href=https://use.typekit.net/bck7qbl.css rel=stylesheet> <link href=/css/app.60cd7715.css rel=stylesheet> </head> <body> <aside class=sidebar> <header> <h1> <a href=/ class=icon-wrapper rel=home> <svg class="icon icon-balance-scale" role=img> <use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-balance-scale /> </svg><br> The Hermetic Vault </a> </h1> <p> typedef typename template </p> </header> <section> <h2 class=icon-wrapper> <svg class="icon icon-tags" role=img> <title>Site Tags</title> <use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-tags /> </svg> </h2> <ul class=inline> <li> <a href=/tag/.net>.NET</a> </li> <li>  <a href=/tag/boost>Boost</a> </li> <li>  <a href=/tag/c%2B%2B>C++</a> </li> <li>  <a href=/tag/ci>CI</a> </li> <li>  <a href=/tag/design-patterns>Design&nbsp;Patterns</a> </li> <li>  <a href=/tag/generic-programming>Generic&nbsp;Programming</a> </li> <li>  <a href=/tag/oop>OOP</a> </li> <li>  <a href=/tag/powershell>PowerShell</a> </li> <li>  <a href=/tag/static-analysis>Static&nbsp;Analysis</a> </li> <li>  <a href=/tag/windows-api>Windows&nbsp;API</a> </li> </ul> </section> <nav> <h2 class=screenreader-only>Site Navigation</h2> <ul class=inline> <li><a href=/ class="icon-wrapper link-icon nav-icon" rel=home title=Home><svg class="icon icon-home" role=img><title>Home</title><use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-home /></svg></a></li> <li><a href=/archive class="icon-wrapper link-icon nav-icon" title=Archive><svg class="icon icon-list" role=img><title>Archive</title><use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-list /></svg></a></li> <li><a href=/feed class="icon-wrapper link-icon nav-icon" rel="home alternate" title="News Feed" type=application/atom+xml><svg class="icon icon-feed" role=img><title>News Feed</title><use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-feed /></svg></a></li> <li><a href=/contact class="icon-wrapper link-icon nav-icon" title=Contact><svg class="icon icon-question" role=img><title>Contact</title><use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-question /></svg></a></li> <li><a href=/about class="icon-wrapper link-icon nav-icon" rel=author title=About><svg class="icon icon-info" role=img><title>About</title><use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-info /></svg></a></li> </ul> </nav> <br> <footer aria-label="Legal Information"> <ul class=inline> <li> <a href=/legal/disclaimer><small>Disclaimer</small></a> <small>‡</small> </li> <li> <a href=/legal/privacy-policy title="Privacy Policy"><small>Privacy</small></a> </li> </ul> <p> <small>© 2019 TheHermeticVault.com</small> </p> </footer> </aside> <main class=content id=main> <div class=page-image itemprop=image itemscope itemtype=https://schema.org/ImageObject style=--aspect-ratio:1.3333333333333333> <img alt="Goethe–Schiller Monument, Syracuse, New York State" class=webfeedsFeaturedVisual itemprop="url contentUrl" src=/img/pages/goethe-schiller-monument.jpg> <meta content=1440 itemprop=width> <meta content=1080 itemprop=height> <small> Goethe–Schiller Monument, Syracuse, New York State </small> </div> <article> <h1 itemprop=headline>Providing Explicit Specialisations for Non‐Template Members of Class Template</h1> <header> <h2 class=screenreader-only>Metadata</h2> <dl class="inline grey"> <div> <dt> <svg class="icon icon-clock-o" role=img> <desc>A clock.</desc> <use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-clock-o /> </svg> Published: </dt> <dd> <time datetime=2015-01-17T00:00:00+03:00 itemprop=datePublished>17 Jan 2015</time>. </dd> </div> <div> <dt> <svg class="icon icon-newspaper-o" role=img> <desc>A newspaper.</desc> <use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-newspaper-o /> </svg> Reading time: </dt> <dd> <time datetime=PT2M itemprop=timeRequired>2 minutes</time>. </dd> </div> <div class="new-line wrap-text"> <dt> <svg class="icon icon-tags" role=img> <title>Tags</title> <use xlink:href=/icn/symbol-defs.ebccfbad.svg#icon-tags /> </svg> </dt> <dd> <ul class=inline> <li> <a href=/tag/c%2B%2B class=main-muted rel=tag>C++</a>, </li> <li> <a href=/tag/generic-programming class=main-muted rel=tag>Generic Programming</a>. </li> </ul> </dd> </div> </dl> <meta content=1825 itemprop=wordCount> <meta content="Software Development" itemprop="articleSection about"> <meta content="Pavel Frolov" itemprop=author> <span itemprop=publisher itemscope itemtype=https://schema.org/Organization> <meta content="The Hermetic Vault" itemprop=name> <span itemprop=logo itemscope itemtype=https://schema.org/ImageObject> <link href=/img/pages/publisher-logo.png itemprop="url contentUrl"> <meta content=600 itemprop=width> <meta content=60 itemprop=height> </span> </span> <meta content=2019-09-28T21:51:17+03:00 itemprop=dateModified> </header> <div class=drop-letter itemprop=articleBody> <p>C++ is full of surprises (albeit not always good ones). It is a well-known fact that you can provide explicit specialisations for function templates and class templates. But it was a total surprise to me that you can define explicit specialisations for non‐template members of class template without specialising the class template itself!</p> <h2 id=technical-details>Technical Details</h2> <p>The following non‐template members of class template can be explicitly specialised:</p> <ul> <li>member function (either static or not);</li> <li>static data member;</li> <li>member enumeration (since C++11);</li> <li>member class.</li> </ul> <p>Let’s see some examples:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=cp>#include &lt;iostream&gt;
#include &lt;string&gt;
</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
<span class=nl>public:</span>
    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Method</span><span class=p>();</span>
    <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>StaticMethod</span><span class=p>();</span>
    <span class=k>static</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>StaticData</span><span class=p>;</span>
    <span class=k>enum</span> <span class=k>class</span> <span class=nc>Enum</span><span class=p>;</span>
    <span class=k>struct</span> <span class=n>InnerStruct</span><span class=p>{</span> <span class=k>static</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>StaticData</span><span class=p>;</span> <span class=p>};</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>Method</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=s>"std::string Foo&lt;T&gt;::Method() - primary template."</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>template</span><span class=o>&lt;&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>Method</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=s>"std::string Foo&lt;T&gt;::Method() - "</span>
        <span class=s>"explicit specialisation for &lt;char&gt;."</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>StaticMethod</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=s>"std::string Foo&lt;T&gt;::StaticMethod() - primary template."</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>template</span><span class=o>&lt;&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>StaticMethod</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=s>"std::string Foo&lt;char&gt;::StaticMethod() - "</span>
        <span class=s>"explicit specialisation for &lt;char&gt;."</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>StaticData</span><span class=p>{</span>
    <span class=s>"std::string Foo&lt;T&gt;::StaticData - primary template."</span> <span class=p>};</span>

<span class=k>template</span><span class=o>&lt;&gt;</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>StaticData</span><span class=p>{</span>
    <span class=s>"std::string Foo&lt;char&gt;::StaticData - "</span>
    <span class=s>"explicit specialisation for &lt;char&gt;."</span> <span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>enum</span> <span class=k>class</span> <span class=nc>Foo</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>Enum</span> <span class=p>{</span> <span class=n>Primary</span> <span class=o>=</span> <span class=mi>0</span> <span class=p>};</span>

<span class=k>template</span><span class=o>&lt;&gt;</span> <span class=k>enum</span> <span class=k>class</span> <span class=nc>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>Enum</span> <span class=p>{</span> <span class=n>Specialised</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>InnerStruct</span><span class=o>::</span><span class=n>StaticData</span><span class=p>{</span>
    <span class=s>"std::string Foo&lt;T&gt;::InnerStruct::StaticData - primary template."</span> <span class=p>};</span>

<span class=k>template</span><span class=o>&lt;&gt;</span> <span class=k>struct</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>InnerStruct</span><span class=p>{</span>
    <span class=k>static</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>StaticData</span><span class=p>;</span> <span class=p>};</span>
<span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>InnerStruct</span><span class=o>::</span><span class=n>StaticData</span><span class=p>{</span>
    <span class=s>"std::string Foo&lt;char&gt;::InnerStruct::StaticData - "</span>
    <span class=s>"explicit specialisation for &lt;char&gt;."</span> <span class=p>};</span>


<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// Member function.</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>().</span><span class=n>Method</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>().</span><span class=n>Method</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>

    <span class=c1>// Static member function.</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>StaticMethod</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>StaticMethod</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>

    <span class=c1>// Static data member.</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>StaticData</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>StaticData</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>

    <span class=c1>// Member enumeration.</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Foo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>Enum</span><span class=o>::</span><span class=n>Primary</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>Enum</span><span class=o>::</span><span class=n>Specialised</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>

    <span class=c1>// Member class.</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>InnerStruct</span><span class=o>::</span><span class=n>StaticData</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Foo</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>InnerStruct</span><span class=o>::</span><span class=n>StaticData</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
<span class=p>}</span></code></pre></figure> <p>When this can be useful? Whenever you need some conditional logic for you class template based on template parameters, but that logic takes only a small fraction of class code. For example, you may have a class containing a dozen of methods, but only a couple of them require behaviour specific to template arguments. In that case, it is not practical to define explicit specialisation for the whole class due to large amount of code duplication. The better solution is to define specialisations only for those specific methods.</p> <p>Perhaps the most useful part of this feature is the ability to specialise member functions. Let’s take a look at a concrete example.</p> <h2 id=implementing-generic-raii-wrapper-for-resource-handles>Implementing Generic RAII Wrapper for Resource Handles</h2> <p>Opaque resource handles are used in many OS‐level, networking, and database APIs. Usually such handles must be closed with some kind of <code class=highlighter-rouge>close_handle</code> function. When dealing with handles in C++ you almost always want to use <em>RAII</em><sup id=fnref:fn-raii><a href=#fn:fn-raii class=footnote>1</a></sup> wrapper to avoid handle leaks. We can define such a wrapper as follows:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=cp>#include &lt;cassert&gt;
#include &lt;memory&gt;  // std::addressof
</span>
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>HandleType</span> <span class=o>=</span> <span class=n>OsHandle</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Handle</span> <span class=p>{</span>
<span class=nl>public:</span>
    <span class=n>Handle</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
    <span class=k>explicit</span> <span class=n>Handle</span><span class=p>(</span><span class=n>HandleType</span> <span class=n>handle</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>handle</span> <span class=p>}</span> <span class=p>{}</span>

    <span class=o>~</span><span class=n>Handle</span><span class=p>()</span> <span class=p>{</span> <span class=n>Cleanup</span><span class=p>();</span> <span class=p>}</span>

    <span class=c1>// Noncopyable.</span>
    <span class=n>Handle</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
    <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>

    <span class=c1>// Movable.</span>
    <span class=n>Handle</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=p>}</span> <span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span> <span class=p>}</span>
    <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>assert</span><span class=p>(</span><span class=k>this</span> <span class=o>!=</span> <span class=n>std</span><span class=o>::</span><span class=n>addressof</span><span class=p>(</span><span class=n>other</span><span class=p>));</span>
        <span class=n>Cleanup</span><span class=p>();</span>
        <span class=n>handle_</span> <span class=o>=</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span><span class=p>;</span>
        <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span>
        <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>HandleType</span><span class=o>*</span> <span class=k>operator</span><span class=o>&amp;</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>Cleanup</span><span class=p>();</span>
        <span class=k>return</span> <span class=o>&amp;</span><span class=n>handle_</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>explicit</span> <span class=k>operator</span> <span class=n>HandleType</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>handle_</span><span class=p>;</span> <span class=p>}</span>

<span class=nl>private:</span>
    <span class=kt>void</span> <span class=n>Cleanup</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>handle_</span><span class=p>)</span>
            <span class=n>CloseOsHandle</span><span class=p>(</span><span class=n>handle_</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>HandleType</span> <span class=n>handle_</span><span class=p>{};</span>
<span class=p>};</span></code></pre></figure> <p>Here <code class=highlighter-rouge>OsHandle</code> is some common handle type in our hypothetical operating system which needs to be closed by <code class=highlighter-rouge>CloseOsHandle</code> function (the real world example is Windows API <code class=highlighter-rouge>HANDLE</code> type with corresponding <code class=highlighter-rouge>CloseHandle</code> function). Example usage:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=n>Handle</span><span class=o>&lt;&gt;</span> <span class=n>handle1</span><span class=p>;</span>  <span class=c1>// using default handle type</span>
<span class=n>Handle</span><span class=o>&lt;</span><span class=n>OsHandle</span><span class=o>&gt;</span> <span class=n>handle2</span><span class=p>;</span>  <span class=c1>// same as above, explicit</span>
<span class=n>Handle</span><span class=o>&lt;</span><span class=n>OsFileHandle</span><span class=o>&gt;</span> <span class=n>handle3</span><span class=p>;</span>  <span class=c1>// OS-specific file handle</span></code></pre></figure> <p>Now suppose we want to use <code class=highlighter-rouge>OsInternetHandle</code> which requires specific <code class=highlighter-rouge>CloseOsInternetHandle</code> function to be closed (this is also common in Windows API: for example, WinHttp <code class=highlighter-rouge>HINTERNET</code> handle requires <code class=highlighter-rouge>WinHttpCloseHandle</code>). We can specialise our <code class=highlighter-rouge>Handle</code> class for <code class=highlighter-rouge>OsInternetHandle</code>:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=k>template</span><span class=o>&lt;&gt;</span> <span class=k>class</span> <span class=nc>Handle</span><span class=o>&lt;</span><span class=n>OsInternetHandle</span><span class=o>&gt;</span> <span class=p>{</span>
<span class=nl>public:</span>
    <span class=n>Handle</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
    <span class=k>explicit</span> <span class=n>Handle</span><span class=p>(</span><span class=n>OsInternetHandle</span> <span class=n>handle</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>handle</span> <span class=p>}</span> <span class=p>{}</span>

    <span class=o>~</span><span class=n>Handle</span><span class=p>()</span> <span class=p>{</span> <span class=n>Cleanup</span><span class=p>();</span> <span class=p>}</span>

    <span class=c1>// Noncopyable.</span>
    <span class=n>Handle</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
    <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Handle</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>

    <span class=c1>// Movable.</span>
    <span class=n>Handle</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=o>:</span> <span class=n>handle_</span><span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=p>}</span> <span class=p>{</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span> <span class=p>}</span>
    <span class=n>Handle</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Handle</span><span class=o>&amp;&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>assert</span><span class=p>(</span><span class=k>this</span> <span class=o>!=</span> <span class=n>std</span><span class=o>::</span><span class=n>addressof</span><span class=p>(</span><span class=n>other</span><span class=p>));</span>
        <span class=n>Cleanup</span><span class=p>();</span>
        <span class=n>handle_</span> <span class=o>=</span> <span class=n>other</span><span class=p>.</span><span class=n>handle_</span><span class=p>;</span>
        <span class=n>other</span><span class=p>.</span><span class=n>handle_</span> <span class=o>=</span> <span class=p>{};</span>
        <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>OsInternetHandle</span><span class=o>*</span> <span class=k>operator</span><span class=o>&amp;</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>Cleanup</span><span class=p>();</span>
        <span class=k>return</span> <span class=o>&amp;</span><span class=n>handle_</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>explicit</span> <span class=k>operator</span> <span class=n>OsInternetHandle</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>handle_</span><span class=p>;</span> <span class=p>}</span>

<span class=nl>private:</span>
    <span class=kt>void</span> <span class=n>Cleanup</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>handle_</span><span class=p>)</span>
            <span class=n>CloseOsInternetHandle</span><span class=p>(</span><span class=n>handle_</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>OsInternetHandle</span> <span class=n>handle_</span><span class=p>{};</span>
<span class=p>};</span></code></pre></figure> <p>The problem is solved, but the cost is a lot of code duplication. As you can see, the only real difference between specialised and primary template is <code class=highlighter-rouge>Cleanup</code> method. Let’s leave our <code class=highlighter-rouge>Handle</code> class definition as is and define specialisation for <code class=highlighter-rouge>Cleanup</code> member function instead:</p> <figure class=highlight><pre><code class=language-c-- data-lang=c++><span class=k>template</span><span class=o>&lt;&gt;</span> <span class=kt>void</span> <span class=n>Handle</span><span class=o>&lt;</span><span class=n>OsInternetHandle</span><span class=o>&gt;::</span><span class=n>Cleanup</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handle_</span><span class=p>)</span>
        <span class=n>CloseOsInternetHandle</span><span class=p>(</span><span class=n>handle_</span><span class=p>);</span>
<span class=p>}</span></code></pre></figure> <p>This is much better for maintainability and works exactly like the class specialisation above.</p> <p>Note that our handle wrapper is somewhat simplified for the purpose of the article. It is assumed that various <code class=highlighter-rouge>HandleType</code> arguments are in fact different types, not an aliases for some built‐in type like <code class=highlighter-rouge>int</code> or <code class=highlighter-rouge>void*</code>. For example, if our <code class=highlighter-rouge>OsHandle</code> and <code class=highlighter-rouge>OsInternetHandle</code> are both defined as synonyms for <code class=highlighter-rouge>int</code>, the above specialisation will not work. For that reason, in real life you almost certainly should apply <a href=https://isocpp.org/blog/2015/01/type-safe-handles-in-c-emil-ernerfeldt rel=external>type‐safe handle idiom</a> to your wrapper class described in the recent <a href=https://isocpp.org rel=external>isocpp.org</a> post by Emil Ernerfeldt. Then you can specialise <code class=highlighter-rouge>Cleanup</code> method on handle tag (which is effectively a form of <em>tag dispatching</em><sup id=fnref:fn-tag-dispatching><a href=#fn:fn-tag-dispatching class=footnote>2</a></sup>).</p> <h2 id=conclusion>Conclusion</h2> <p>Although described in <cite>Section 14.7 [temp.spec] of the C++ ISO/IEC standard</cite>, this unobvious feature is poorly documented elsewhere. In fact, I’ve found only a couple of reference manuals mentioning it:</p> <ul> <li><a href=http://en.cppreference.com/w/cpp/language/template_specialization rel=external>cppreference.com</a>;</li> <li><a href=https://www.ibm.com/support/knowledgecenter/SSLTBW_2.1.0/com.ibm.zos.v2r1.cbclx01/explicit_specialization.htm rel=external>z/OS XL C/C++ Language Reference</a>.</li> </ul> <hr> <h2 class=screenreader-only id=footnotes>Footnotes</h2> <div class=footnotes> <ol> <li id=fn:fn-raii> <p><a href=https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization>Resource Acquisition Is Initialization</a>. <a href=#fnref:fn-raii class=reversefootnote>↑</a></p> </li> <li id=fn:fn-tag-dispatching> <p>Tag dispatching is a way of using function overloading to dispatch based on properties of a type. See <a href=https://isocpp.org/blog/2014/12/tag-dispatching rel=external>tutorial on tag dispatching</a>. <a href=#fnref:fn-tag-dispatching class=reversefootnote>↑</a></p> </li> </ol> </div> </div> <aside> <h2 class=screenreader-only>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template",this.page.identifier="urn:uuid:09e7137d-33df-4c82-bfde-574f3289bea6",this.page.title="Providing Explicit Specialisations for Non‐Template Members of Class Template"};!function(){var e=document,t=e.createElement('script');t.src='https://arkfps.disqus.com/embed.js',t.setAttribute('data-timestamp',+new Date),(e.head||e.body).appendChild(t)}()</script> <noscript><i>Please enable JavaScript to view the comments.</i></noscript> </aside> </article> <script type=application/ld+json> { "@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [ { "@type": "ListItem", "position": 1, "item": { "@id": "https://thehermeticvault.com", "name": "Home" } }, { "@type": "ListItem", "position": 2, "item": { "@id": "https://thehermeticvault.com/tag/c%2B%2B", "name": "C++" } }, { "@type": "ListItem", "position": 3, "item": { "@id": "https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template", "name": "Providing Explicit Specialisations for Non‐Template Members of Class Template" } } ] } </script> <script type=application/ld+json> { "@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [ { "@type": "ListItem", "position": 1, "item": { "@id": "https://thehermeticvault.com", "name": "Home" } }, { "@type": "ListItem", "position": 2, "item": { "@id": "https://thehermeticvault.com/tag/generic-programming", "name": "Generic Programming" } }, { "@type": "ListItem", "position": 3, "item": { "@id": "https://thehermeticvault.com/software-development/providing-explicit-specialisations-for-non-template-members-of-class-template", "name": "Providing Explicit Specialisations for Non‐Template Members of Class Template" } } ] } </script> </main> <script> window.onpageshow = (evt) => {
        'use strict';
        // Scroll view to main content area of page if not coming from history.
        if (window.location.hash) return;  // ignore URLs with fragment
        const nav = performance.getEntriesByType('navigation');
        if (nav.length) {  // for Chrome/Opera, Firefox, Edge
          if (nav[0].type === 'back_forward') return;
        } else if (evt.persisted) { // for Safari
          return;
        }
        const main = document.getElementById('main');
        if (main.scrollIntoView) main.scrollIntoView({ behavior: 'smooth' });
      }; </script> </body> </html> 